### 엄청나게 많은 요청이 들어오는 게시판에 게시글마다 조회수를 관리해주어야 한다.무슨 문제가 있고 어떻게 설계해야 할까?


    
    조회수는 DB에 저장해야 한다. 
    
    사용자가 게시글을 조회할 때마다 DB에 값을 수정해준다고 해보자. 
    
    동시성 이슈가 있을 수 있기 때문에 테이블에 락을 건다면 성능이 저하된다.
    
    즉 데이터의 정합성과 성능 둘 중 하나는 포기해야 하는 상황이다.
    
    먼저 이 조회수라는 데이터의 특징을 살펴보자.
    
    조회수는 상품의 가격처럼 사용자가 지금 당장 정확한 값을 확인해야하는 그런 데이터는 아니다. 따라서 성능이 빠른 메모리 DB에 데이터를 모았다가 주기적으로 디스크 DB에 반영해주는 방법이 있을 수 있다. 
    
    이 때 레디스를 이용한다면 싱글 쓰레드로 작동하기 때문에 동시성 이슈가 발생하지 않으며 메모리DB이기 때문에 빠르게 값을 업데이트할 수 있다.

### 마스크 대란과 같이 요청량이 감당이 안될 정도로 늘 때 서버가 뻗지 않기 위해 어떻게 하면 좋을까?
    
    기본적으로 쓰레드 풀을 통해 요청된 작업을 수행하는 쓰레드의 수를 제한함으로써 서버가 다운되는 것을 막을 수 있다. 
    그러나 대기되는 요청 또한 리소스를 잡아먹기 때문에 요청이 걷잡을 수 없이 늘어난다면 서버가 다운될 수 있다.
    
    따라서 이 때는 nginx의 rate limit과 같은 기능을 통해 아예 connection 맺기를 거절할 수 있다. 
    이 때 거절된 사용자는 사용자는 503 코드와 함께 내부적으로 서버가 문제 있다는 메세지를 받게 된다.