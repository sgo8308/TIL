### DB설계를 공부해야 하는 이유는?
    
    시행착오를 통해도 좋은 설계를 배울 수 있지만 시간이 많이 걸린다.
    
    아무렇게나 골프채를 휘두르며 골프공을 쳐도 언젠가는 좋은 샷을 때릴 수 있다.
    
    그러나 좋은 자세와 집중해야 하는 점 등을 미리 알고 진행하는 연습은 훨씬 빠르게 실력을 향상 시킨다.
    
### DB설계의 가장 중요한 기준은 무엇일까?
    1. 필수 및 임의적인 정보 검색을 모두 지원해야 한다.
    
        설계 과정에서 정의한 요구사항 뿐만 아니라 사용자에 의해 제기될 수 있는 임의의 질의를 지원하기 위해 필요한 데이터는 반드시 저장해야 한다.
    
    2. 데이터의 손실, 부정확함, 중복, 불일치, 오류와 같은 것들이 없어야 한다.
    
    3. 데이터를 쉽게 수정할 수 있어야 한다. 
        
        테이블 내의 필드값을 변경하는 것이 테이블 내의 다른 필드들의 값에 부정적인 영향을 주지 않아야 한다.
        
    4. 요구사항 변화에 의한 확장이나 수정이 쉬워야 한다.

    5. 정보 검색이 쉬워야 한다.
    
### DB설계의 단계는 어떻게 될까?
    1.  임무 명세와 임무 목표 정의
        1. 임무 명세 : 마이크의 자전거 가게 데이터베이스의 목적은 우리의 소매 사업과 고객 서비스 활동을 지원할 때 필요한 데이터를 관리하기 위함이다.
        2. 임무 목표
            1. 고객의 자동차에 대한 정보를 관리한다.
            2. 작업 지시 이력을 관리한다.
            
                  ...
            
    2. 데이터 구조 생성
        1. 테이블 정의 : 테이블이 하나의 주제만 표현하는지, 중복된 필드가 없는지 확인
        2. 필드 검토 : 다중 구성이나 다중값 필드 개선
        3. 키 설정
        4. 필드 명세 설정

    3. 테이블 관계 연결 및 결정
        1. 관계 확인
        2. 기본 키나 외래 키 연결테이블을 통해 논리적인 연결 설정
        3. 테이블에 대한 참여의 유형과 정도 결정

    4. 업무 규칙 정의 및 결정
        1. 업무 규칙 정의 : ex) 1명의 매니저는 10명의 연예인 이상 관리할 수 없다.
        2. 검증 테이블 정의 구현 : 어떤 필드에 일정 범위 내의 값들만 들어갈 수 있다면 이런 필드에 저장된 값들의 일관성과 유효성을 보장하기 위해 사용

    5. 뷰의 정의 및 결정
        1. 데이터를 어떤 식으로 처리하는지 확인
        2. 적당한 테이블과 필드를 사용하여 뷰를 정의
        3. 뷰에 대한 표준 설정

    6. 데이터 무결성 재확인
        1. 테이블 무결성 확인
        2. 필드 무결성 확인
        3. 관계 무결성 검토
        4. 업무 규칙 검토
### 임무 명세란?
    
    임무 명세란 일반적인 용어로 데이터베이스의 특정한 목적을 정의한 것이다.
    
    설계할 때 초점을 맞춰야 하는 부분을 알려주고 산만하고 불필요하게 크거나 복잡한 데이터베이스 구조를 만들지 않도록 해준다. 
    특정업무를 명확하게 묘사하는 문장 없이 간결하게 요점을 잘 표현해야 한다.
    
    예시
    
    1. 왓컴 주 청문회 심사관의 데이터베이스의 목적은 왓컴 주의 시민들이 제출한 토지 사용 요청서에 대한 심의를 하기 위해 심사관의 사무실에서 사용하는 데이터를 관리하기 위한 것이다.
    2. New Starz Talent Agency 데이터베이스의 목적은 생성되는 데이터베이스를 관리하고 우리가 연예인들에게 제공하는 관리 서비스와 공객에게 제공하는 계약 서비스를 지원하기 위한 정보를 공급하는 데 있다.
## 테이블
### 테이블의 대상은 어떤게 있을까?
        
    테이블의 대상은 객체가 될 수도 있고, 이벤트가 될 수도 있다. 
    
    객체일 경우 사람이나 장소 혹은 물건과 같은 유형의 사물을 의미한다.
    
    이벤트일 경우 테이블이 기록하고자 하는 특성들을 특정 시간대에 발생하는 것들을 표시하는 것을 의미한다.
        
### 테이블은 어떻게 나누어야 할까?
    임무 목표, 예비 필드 목록 등을 이용해 나눈다.

### 이상적인 테이블의 요소는 어떤게 있을까?
    - 개체 또는 사건일 수 있는 단일 주제를 나타낸다.
    
    각 테이블이 단일 주제를 나타내는 한 중복되는 데이터를 줄일 수 있기 때문에 잠재적인 데이터 무결성 문제의 위험이 크게 줄어든다.
    
    ---
    
    [https://support.microsoft.com/en-us/office/database-design-basics-eb2159cf-1e30-401a-8084-bd4f9c9ca1f5#bmgood](https://support.microsoft.com/en-us/office/database-design-basics-eb2159cf-1e30-401a-8084-bd4f9c9ca1f5#bmgood)
    
    - 기본 키를 가진다.
    
    레코드들을 유일하게 식별하고 테이블의 관계를 설정을 위해 필요하다.
    
    기본 키가 없어도 무결성 문제가 생길 수 있다.
    
## 필드
### 이상적인 필드의 요소는 어떤게 있을까?
    - 테이블 주제의 고유한 특성을 나타낸다.

    - 오직 하나의 값만 포함한다. (다중 값 필드 안된다.)
        - 다중 값 필드는 데이터 중복 문제를 일으킨다.
        - 안에 데이터를 수정, 삭제, 정렬, 그룹화하려고 할 때 사용하기 힘들다.

    - 더 작은 구성요소로 해체될 수 없다. (다중 구성 필드 안된다)
        - 다중값 필드처럼 이 안의 데이터를 수정, 삭제, 정렬, 그룹화하려고 할 때 문제를 일으킨다.
            
            Address
            3131 Mockingbird Lane Seattle, WA 98157 
            
            위와 같은 필드는 시애틀 시를 위한 정보를 검색하거나 우편번호로 정보를 정렬하는 데 어려움을 겪는다.
            
    - 계산되거나 연결된 값을 포함하지 않는다. 
        ex ) name은 first name 과 last name을합친 필드다.
            - 계산된 필드는 다른 칼럼에 의존한다. 다른 칼럼이 수정되었을 때 이 칼럼도 수정되어야 하는데 이 수정이 함께 진행되지 않아 데이터 정합성에 어긋나기 쉽다.

    - 전체 데이터베이스 구조 안에서 유일한다.
        - 유일한 이중 필드는 테이블의 관계를 설정하는 필드여야 한다. 이 것 이외에 이중 필드가 나타나면 일관성이 없게 될 것이 틀림없다.  ex)한쪽은 10인데 한쪽은 20을 갖고 있는

    - 하나 이상의 테이블에 나타날 때는 속성들의 대부분을 유지한다. ??
### 좋지 않은 필드는 어떤 필드일까?
    1. 계산된 필드
    2. 다중 구성 필드
    3. 다중값 필드
    
    Id First Name Last Name    Full Name     (City, State, Zip) Account Rep
    1   Stewart    Jameson  Stewart Jameson  Seattle, WA 98125  John, Sandi
    
    Full Name → 계산된 필드
    
    City, State, Zip → 다중 구성 필드
    
    Account Rep → 다중 값필드
    
### null값은 왜 안좋을까?
    1. null값은 오해를 불러일으키기 때문에 안 좋다.
        
        null 값은 다음과 같이 해석될 수 있다.
        
        1. 값이 아무 것도 없다.
        2. 값이 아직 입력되지 않았다.
        3. 에러가 발생해서 값이 누락되었다. 등등
        
        이와 같이 어떤 레코드에 null 값이 있을 때 이 값이 무엇을 의미하는지 명확하지가 않기 때문에 피하는 것이 좋다.
        
    
    2. null이 포함된 연산은 그 결과가 null로 나오기 대문에 수학적 연산에 안 좋다.
    
    ---
    
    [https://stackoverflow.com/questions/163434/are-nulls-in-a-relational-database-okay#:~:text=Nulls are negatively viewed from,items which have no value](https://stackoverflow.com/questions/163434/are-nulls-in-a-relational-database-okay#:~:text=Nulls%20are%20negatively%20viewed%20from,items%20which%20have%20no%20value).
    
    마이클 J. 헤르난데즈, 파워 오브 데이터베이스, 비제이퍼블릭, 초반 1쇄, 33-34, 2019
    
### null값은 언제 허용해줄까?
    
    성능 이슈 때문에 나누어진 테이블을 다시 합치는게 불가피할 때(Join 횟수를 줄이기 위해) 생겨나는 null값은 어쩔 수 없다.
    
    ---
    
    [https://stackoverflow.com/questions/163434/are-nulls-in-a-relational-database-okay#:~:text=Nulls are negatively viewed from,items which have no value](https://stackoverflow.com/questions/163434/are-nulls-in-a-relational-database-okay#:~:text=Nulls%20are%20negatively%20viewed%20from,items%20which%20have%20no%20value).
    
### 언제 ENUM을 쓰고 언제 참조 테이블을 쓸까?
    
    기본적으로는 ENUM을 쓰는게 테이블 수도 줄이고 Join도 필요 없어서 성능에 약간 좋다. 따라서 ENUM을 쓰지 않아야 할 상황을 제외하면 ENUM을 쓰는게 좋을 것 같다.
    
    ENUM의 장점 
    
    1. 쿼리가 참조 테이블을 쓸 때에 비하여 간단하다.
    2. 쿼리에서 id가 아닌 ENUM 값을 그대로 집어 넣을 수 있어 명확하다.
        
        ex) color = 1이 아닌 color = 'Red'
        
        하지만 다음과 같이 쓸 수 있긴 하지만 복잡해진다.
        
        INSERT INTO 'main_table' ('field_1', 'field_2', 'color_id')
        VALUES (
        'foo', 
        'bar', 
        (SELECT color.color_id FROM color WHERE color.color_name = 'red')
        )
        
    3. 성능이 약간 더 좋다. 
    
    ENUM의 단점
    
    1. ENUM 칼럼은 속성을 추가하거나 연관된 정보를 저장할 수 없지만 참조 테이블은 가능하다.
    2. ENUM 칼럼에 정의된 값들은 다른 테이블에서 재사용할 수 없다.
    3. ENUM 모든 데이터 목록을 조회하는 것이 힘들다.
        
        코드 상에서 ENUM 목록을 표현할 경우 ENUM 값을 수정할 때마다 코드와 DB 테이블 두군데를 수정해야 하고 재컴파일 재배포가 필요하다.
        
    4. ENUM의 들어있는 값을 수정하거나 추가하려면 테이블을 ALTER 해야 하고 테이블이 거대할 경우 비용이 많이 든다.(시간)
    
    ---
    
    [http://komlenic.com/244/8-reasons-why-mysqls-enum-data-type-is-evil/](http://komlenic.com/244/8-reasons-why-mysqls-enum-data-type-is-evil/)
    
### DATETIME vs TIMESTAMP
    1. TIMESTAMP는 범위가 
    
    '1970-01-01 00:00:01.000000' to'2038-01-19 03:14:07.999999'
    
    이기 때문에 2038년 이후에는 데이터를 저장하고 싶지 않은게 아니라면 DATETIME을 써야할 것 같다. 
    
    - DATETIME이 TIMESTAMP보다 데이터 읽어드릴 때 편하다는 것은 무슨 말일까?

## 키
### 자연키 vs 인조키
    - 자연키

        - 장점
            
            MySQL의 InnoDB스토리지 엔진의 경우 기본키를 바탕으로 테이블 자체가 클러스터링 인덱스가 되기 때문에 자연키를 기본키로 한다면 이 자연키를 위해 따로 인덱스를 구성할 필요가 없다. 
            
            클러스터링 인덱스가 될 경우 기본키를 기준으로 범위 검색 시 매우 빠르다.
            
            커버링 인덱스가 작용할 가능성이 높다.
            
            인조키를 위한 추가 공간이 필요하지 않다.
            
        - 단점
            
            비즈니스 요구사항에 의해서 기본키로 사용하던 자연키에 변화가 생기면 문제가 생길 수 있다. 예를 들어 직원 목록에 주민번호를 기본키로 사용했는데 주민번호가 없는 외국인 직원이 생기면 난감하다.
            
            삽입 삭제 시 테이블을 자연키에 맞춰 다시 정렬해줘야 하기 때문에 느리다.
            
    - 인조키

        - 장점
            
            비즈니스 요구사항 변화에 영향 받지 않는다.
            
            삽입시 추가된 데이터의 인조키 값이 항상 다른 데이터보다 크기 때문에 따로 정렬이 필요 없어서 빠르다. 삭제할 경우에도 따로 정렬해줄 필요가 없다.
            
        
### 1대1 관계에서 언제 기본키와 외래키가 동일한 방식을 사용할까?
    
    만약 두 테이블이 같은 주제를 갖고 있다면 사용한다.
    
    일반적으로 필드 하나를 줄이는게 테이블의 크기를 줄일 수 있기 때문에 좋은 것 같다.
    
    ---
    
    [https://support.microsoft.com/en-us/office/database-design-basics-eb2159cf-1e30-401a-8084-bd4f9c9ca1f5](https://support.microsoft.com/en-us/office/database-design-basics-eb2159cf-1e30-401a-8084-bd4f9c9ca1f5#bmtablerelationships) **Creating a one-to-one relationship**


## 관계
### 다대다 관계가 좋지 않은 이유는 뭘까?
    
    다대다 관계를 가진 테이블을 설계하다 보면 필연적으로 좋지 않은 필드 구조를 갖게 되기 때문이다.
    
    그렇게 되면
    
    1. 테이블 중 하나에는 대량의 중복 데이터가 포함될 것이다.
    2. 데이터를 삽입 / 갱신 / 삭제 하기가 어려울 것이다.
### 부모 테이블과 자식 테이블은 어떻게 정할까?
    
    자식 테이블에 있는 레코드는 반드시 부모 테이블과 관련이 있어야 한다는 관점으로 접근한다.
    
    예를 들어 직원 테이블과 보상 테이블이 있을 때 보상 테이블(어떤 직원이 얼마를 받는지)을 자식 테이블로 정하는 것이 합리적인데, 
    왜냐하면 직원과 관련이 없는 보상 테이블은 말이 안되기 때문이다. 
    
    부모 테이블은 꼭 자식과 관련될 필요가 없을 수도 있기 때문에, 부모 테이블로 삼아야 할 것을 자식 테이블을 삼으면 외래키에 null값이 많이 생길 것이다.
    
    ---
    
    마이클 J. 헤르난데즈, 파워 오브 데이터베이스, 비제이퍼블릭, 초반 1쇄, 254p , 2019